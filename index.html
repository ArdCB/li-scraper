<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>LinkedIn Activity → Excel</title>

  <link rel="stylesheet" href="style.css" />

  <!-- PyScript runtime -->
  <link rel="stylesheet"
        href="https://pyscript.net/releases/2024.1.1/core.css" />
  <script type="module"
          src="https://pyscript.net/releases/2024.1.1/core.js"></script>

  <py-config>
    packages = ["beautifulsoup4", "openpyxl", "pandas"]
    [[fetch]]
    files = ["social_html_scraper.py"]
  </py-config>
</head>

<body>
  <h1>LinkedIn Activity → Excel</h1>
  <p>Choose a saved LinkedIn <em>.html</em> activity page (posts or comments):</p>

  <input type="file" id="file-input" accept=".html" />
  <button id="convert-btn">Convert&nbsp;⇨</button>
  <a id="download-link" style="display:none"></a>

  <!-- controller -->
<py-script>
import js, base64, traceback
from pyodide.ffi import create_proxy
from social_html_scraper import linkedin_html_to_excel

file_el     = js.document.getElementById("file-input")
convert_btn = js.document.getElementById("convert-btn")
dl_link     = js.document.getElementById("download-link")

def _on_select(evt):
    convert_btn.disabled = (file_el.files.length == 0)
file_el.onchange = create_proxy(_on_select)

async def convert(evt):
    try:
        if file_el.files.length == 0:
            return
        fobj = file_el.files.item(0)       # <-- fixed line
        html = await fobj.text()

        xls  = linkedin_html_to_excel(html)   # run scraper
        b64  = base64.b64encode(xls).decode()

        dl_link.href     = ("data:application/vnd.openxmlformats-"
                            "officedocument.spreadsheetml.sheet;base64," + b64)
        dl_link.download = fobj.name.replace(".html", ".xlsx")
        dl_link.textContent = f"Download “{dl_link.download}”"
        dl_link.style.display = "inline"
    except Exception as e:
        js.console.error("Conversion failed:", traceback.format_exc())
        dl_link.style.display = "none"
convert_btn.onclick = create_proxy(convert)
</py-script>
</body>
</html>
